import{aw as j,ax as z,N as g}from"./app-cacd0493.js";import{m as B,c as b,r as d,N as c,O as _,P as a,a1 as o,W as i,u as t,ae as q,am as y,_ as P,a9 as R,G as A}from"./framework-ffef1a40.js";import{N as w}from"./Button-0d2c035d.js";import{N as C}from"./Alert-e32585b0.js";import{N as I}from"./Image-9a505cd7.js";import"./browser-90c586ea.js";import"./Popover-1f69c6ca.js";import"./Scrollbar-ddf979ce.js";import"./utils-76c4cc76.js";function Q(){const u=B(j,null);return u===null&&z("use-message","No outer <n-message-provider /> founded. See prerequisite in https://www.naiveui.com/en-US/os-theme/components/message for more details. If you want to use `useMessage` outside setup, please check https://www.naiveui.com/zh-CN/os-theme/components/message#Q-&-A."),u}const T=b({__name:"Request",setup(u){const f="https://alist.nn.ci/tool/aliyundrive/callback",S="76917ccccd4441c39457a04f6084fb2f";function m(){const e=new URL("https://open.aliyundrive.com/oauth/authorize");e.searchParams.set("client_id",S),e.searchParams.set("redirect_uri",f),e.searchParams.set("scope","user:base,file:all:read,file:all:write"),e.searchParams.set("response_type","code"),e.searchParams.set("state",""),window.open(e.toString(),"_blank")}const s=d(),k="https://api.nn.ci",v=d(!1);async function x(){try{v.value=!0;const n=await(await fetch(k+"/alist/ali_open/qr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})})).json();s.value=n}catch(e){console.log(e),s.value={error:"error",qrCodeUrl:"",sid:""}}finally{v.value=!1}}const p=d(),h=d(!1),N=Q();async function U(){var e;try{h.value=!0;const r=await(await fetch(`${k}/proxy/https://open.aliyundrive.com/oauth/qrcode/${(e=s.value)==null?void 0:e.sid}/status`)).json();if(p.value=r,r.status==="LoginSuccess"){const l=new URL(f);l.searchParams.set("code",r.authCode),window.open(l.toString(),"_blank")}else N.warning(r.status)}catch(n){console.log(n),N.error(String(n))}finally{h.value=!1}}return(e,n)=>(c(),_(t(g),{vertical:"",size:"large"},{default:a(()=>{var r,l;return[o(t(w),{size:"large",type:"primary",onClick:m,block:""},{default:a(()=>[i("Go to login")]),_:1}),o(t(w),{size:"large",type:"info",onClick:x,block:"",loading:v.value,disabled:!!s.value},{default:a(()=>[i("Scan QrCode ")]),_:1},8,["loading","disabled"]),(r=s.value)!=null&&r.error?(c(),_(t(C),{key:0,title:"Error",type:"error"},{default:a(()=>[i(q(s.value.error),1)]),_:1})):y("v-if",!0),(l=s.value)!=null&&l.qrCodeUrl?(c(),_(t(g),{key:1,vertical:""},{default:a(()=>[o(t(g),{justify:"center"},{default:a(()=>[o(t(I),{width:"300",src:s.value.qrCodeUrl},null,8,["src"])]),_:1}),o(t(C),{title:"Scan the QrCode",type:"info"},{default:a(()=>[i("Use AliyunDrive APP To Scan Then Click the Button Below")]),_:1}),o(t(w),{size:"large",onClick:U,type:"info",block:"",loading:h.value},{default:a(()=>[i("I have scan")]),_:1},8,["loading"])]),_:1})):y("v-if",!0),p.value&&p.value.status!=="LoginSuccess"?(c(),_(t(C),{key:2,title:"Warning",type:"warning"},{default:a(()=>[i(q(p.value.status),1)]),_:1})):y("v-if",!0)]}),_:1}))}});const L=P(T,[["__scopeId","data-v-21249173"],["__file","Request.vue"]]),E=b({__name:"request.html",setup(u){return(f,S)=>{const m=A("NaiveClient");return c(),R("div",null,[o(m,null,{default:a(()=>[o(t(L))]),_:1})])}}}),F=P(E,[["__file","request.html.vue"]]);export{F as default};
