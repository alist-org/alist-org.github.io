import{c as b,b as P,u as t,N as s,O as n,P as i,a5 as a,a7 as l,Q as o,aa as p,Z as d,a4 as N,_ as T,G as U}from"./framework-65876511.js";import{N as f,a as y}from"./Spin-08829354.js";import{N as v,a as k}from"./Space-ed3f6b4b.js";import{N as B}from"./Button-65c4a5a3.js";import"./app-05c8b916.js";import"./Close-507d69bf.js";const O=o("b",null,"client_id: ",-1),j=o("b",null,"client_secret: ",-1),w=o("b",null,"zone: ",-1),V=o("p",null,[o("b",null,"redirect_uri: "),a("https://alist.nn.ci/tool/onedrive/callback")],-1),D=o("b",null,"refresh_token:",-1),G=o("h3",null,"Get sharepoint site ID",-1),E={key:2},J=o("b",null,"site_id: ",-1),A=b({__name:"Callback",setup(x){const _=new URL(window.location.href),u=_.searchParams.get("code"),c=_.searchParams.get("state"),h=_.searchParams.get("error"),C=_.searchParams.get("error_description"),e=P({refreshToken:"",accessToken:"",error1:"",errorMessage1:"",siteUrl:"",siteId:"",error2:"",errorMessage2:"",gettingSiteId:!1});u&&c&&!h&&(()=>{fetch("https://api.nn.ci/alist/onedrive/get_refresh_token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:u,client:c})}).then(r=>r.json()).then(r=>{if(console.log(r),r.error){e.error1=r.error,e.errorMessage1=r.error_description;return}e.refreshToken=r.refresh_token,e.accessToken=r.access_token})})();const[S,I,g]=atob(c).split("::"),M=()=>{e.gettingSiteId=!0,fetch("https://api.nn.ci/alist/onedrive/get_site_id",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({site_url:e.siteUrl,access_token:e.accessToken,zone:g})}).then(r=>(e.gettingSiteId=!1,r.json())).then(r=>{if(r.error){e.error2=r.error,e.errorMessage2=r.error.message;return}e.siteId=r.id})};return(r,m)=>!t(u)||!t(c)||t(h)?(s(),n(t(f),{key:0,title:t(h)||"Error",type:"error"},{default:i(()=>[a(l(t(C)),1)]),_:1},8,["title"])):(s(),n(t(k),{key:1,vertical:"",size:"large"},{default:i(()=>[o("p",null,[O,a(l(t(S)),1)]),o("p",null,[j,a(l(t(I)),1)]),o("p",null,[w,a(l(t(g)),1)]),V,e.error1||e.errorMessage1?(s(),n(t(f),{key:0,title:e.error1,type:"error"},{default:i(()=>[a(l(e.errorMessage1),1)]),_:1},8,["title"])):p("v-if",!0),d(t(k),{vertical:""},{default:i(()=>[D,e.refreshToken?(s(),n(t(v),{key:1,type:"textarea",autosize:"",readonly:"",value:e.refreshToken},null,8,["value"])):(s(),n(t(y),{key:0}))]),_:1}),e.accessToken?(s(),n(t(k),{key:1,vertical:"",size:"large"},{default:i(()=>[G,e.error2||e.errorMessage2?(s(),n(t(f),{key:0,title:e.error2,type:"error"},{default:i(()=>[a(l(e.errorMessage2),1)]),_:1},8,["title"])):p("v-if",!0),d(t(v),{placeholder:"input site url (https://xx.sharepoint.xx/sites/xx)",size:"large",value:e.siteUrl,"onUpdate:value":m[0]||(m[0]=z=>e.siteUrl=z)},null,8,["value"]),d(t(B),{type:"primary",size:"large",onClick:M},{default:i(()=>[a("Get SiteID")]),_:1}),e.gettingSiteId?(s(),n(t(y),{key:1})):e.siteId?(s(),N("p",E,[J,a(l(e.siteId),1)])):p("v-if",!0)]),_:1})):p("v-if",!0)]),_:1}))}});const L=T(A,[["__file","Callback.vue"]]),Q=b({__name:"callback.html",setup(x){return(_,u)=>{const c=U("NaiveClient");return s(),N("div",null,[d(c,null,{default:i(()=>[d(t(L))]),_:1})])}}}),W=T(Q,[["__file","callback.html.vue"]]);export{W as default};
